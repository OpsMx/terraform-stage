job:
  preconfigured:
    kubernetes:      
      - label: TSPlanJob
        application: terratest
        cloudProvider: kubernetes
        credentials: default
        description: Stage for terraspin plan operation
        account: default
        type: customTSPlanJobStage
        waitForCompletion: true
        parameters:
          - defaultValue: >-
              < artifact account name on which your terrafrom infracode present
              >
            description: pass your artifact account name.
            label: Artifact account
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: Artifact account
          - defaultValue: < artifact path where terraform infracode present >
            description: pass terraform module repo where your tf infra code present.
            label: Terraform plan
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: Terraform plan
          - defaultValue: < artifact override file path for overriding default values >
            description: pass overrideVariableFile path if you want to override variables.
            label: Override file
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: Override file
          - defaultValue: >-
              < specify repo name on which you want to store states of terraform
              plan, apply and destroy >
            description: >-
              pass repo name where you want to save intermediate state of
              terraform state.
            label: State repo
            mapping: 'manifest.spec.template.spec.containers[0].env[3].value'
            name: State repo
          - defaultValue: >-
              < Unique string, give the same string in the plan, apply and
              destroy stages >
            description: pass unique user id.
            label: UUId
            mapping: 'manifest.spec.template.spec.containers[0].env[4].value'
            name: UUId
        manifest:
          apiVersion: batch/v1
          kind: Job
          metadata:
            name: terraspinplanjob
            namespace: spin
          spec:
            backoffLimit: 0
            template:
              spec:
                containers:
                  - command:
                      - PlanRun.sh
                    env:
                      - name: artifactAccount
                        value: 
                      - name: plan
                        value: 
                      - name: variableOverrideFileRepo
                        value: 
                      - name: stateRepo
                        value: 
                      - name: uuId
                        value: 
                      - name: component
                        value: plan
                    image: 'docker.io/opsmx11/terraspinjob:3.0'
                    imagePullPolicy: Always
                    name: terraspinplan
                    volumeMounts:
                      - mountPath: /home/terraspin/opsmx/app/config/
                        name: opsmx-terraspin-backend-config
                restartPolicy: Never
                volumes:
                  - configMap:
                      name: terraspinbackendconfig
                    name: opsmx-terraspin-backend-config


      - label: TSApplyJob
        application: terratest
        cloudProvider: kubernetes
        credentials: default
        description: Stage for terraspin apply operation
        account: default
        propertyFile: terraspinapply
        type: customTSApplyJobStage
        waitForCompletion: true
        parameters:
          - defaultValue: >-
              < artifact account name on which your terrafrom infracode present
              >
            description: pass git account name.
            label: Artifact account
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: Artifact account
          - defaultValue: < artifact override file path for overriding default values >
            description: pass overrideVariableFile path if you want to override variables.
            label: Override file
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: Override file
          - defaultValue: >-
              < specify repo name on which you want to store states of terraform
              plan, apply and destroy >
            description: >-
              pass repo name where you want to save intermediate state of
              terraform state.
            label: State repo
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: State repo
          - defaultValue: >-
              < Unique string, give the same string in the plan, apply and
              destroy stages >
            description: pass unique user id.
            label: UUId
            mapping: 'manifest.spec.template.spec.containers[0].env[3].value'
            name: UUId
        manifest:
          apiVersion: batch/v1
          kind: Job
          metadata:
            name: terraspinapplyjob
            namespace: spin
          spec:
            backoffLimit: 0
            template:
              spec:
                containers:
                  - command:
                      - ApplyRun.sh
                    env:
                      - name: artifactAccount
                        value: 
                      - name: variableOverrideFileRepo
                        value: 
                      - name: stateRepo
                        value: 
                      - name: uuId
                        value: 
                      - name: component
                        value: apply
                    image: 'docker.io/opsmx11/terraspinjob:3.0'
                    imagePullPolicy: Always
                    name: terraspinapply
                    volumeMounts:
                      - mountPath: /home/terraspin/opsmx/app/config/
                        name: opsmx-terraspin-backend-config
                restartPolicy: Never
                volumes:
                  - configMap:
                      name: terraspinbackendconfig
                    name: opsmx-terraspin-backend-config


      - label: TSDestroyJob
        application: terratest
        cloudProvider: kubernetes
        credentials: default
        description: Stage for terraspin destroy operation
        account: default
        type: customTSDestroyJobStage
        waitForCompletion: true
        parameters:
          - defaultValue: >-
              < artifact account name on which your terraform infracode present
              >
            description: pass git account name.
            label: Artifact account
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: Artifact account
          - defaultValue: >-
              < specify repo name on which you want to store states of terraform
              plan, apply and destroy >
            description: >-
              pass repo name where you want to save intermediate state of
              terraform state.
            label: State repo
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: State repo
          - defaultValue: >-
              < Unique string, give the same string in the plan, apply and
              destroy stages >
            description: pass unique user id.
            label: UUID
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: UUID
        manifest:
          apiVersion: batch/v1
          kind: Job
          metadata:
            name: terraspindestroyjob
            namespace: spin
          spec:
            backoffLimit: 0
            template:
              spec:
                containers:
                  - command:
                      - DestroyRun.sh
                    env:
                      - name: artifactAccount
                        value: 
                      - name: stateRepo
                        value: 
                      - name: uuId
                        value: 
                      - name: component
                        value: destroy
                    image: 'docker.io/opsmx11/terraspinjob:3.0'
                    imagePullPolicy: Always
                    name: terraspindestroy
                    volumeMounts:
                      - mountPath: /home/terraspin/opsmx/app/config/
                        name: opsmx-terraspin-backend-config
                restartPolicy: Never
                volumes:
                  - configMap:
                      name: terraspinbackendconfig
                    name: opsmx-terraspin-backend-config
