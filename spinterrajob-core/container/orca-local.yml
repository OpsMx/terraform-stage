job:
  preconfigured:
    kubernetes: 
      - label: TSPlanJob
        application: test
        cloudProvider: kubernetes
        credentials: default
        description: Stage for terraspin plan operation
        account: default
        type: customTSPlanJobStage
        waitForCompletion: true
        parameters:
          - defaultValue: "ex1" 
            description: pass your artifact account name.
            label: Artifact account
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: Artifact account
          - defaultValue: "ex2" 
            description: pass terraform module repo where your tf infra code present.
            label: Terraform plan
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: Terraform plan
          - defaultValue: "ex3" 
            description: pass overrideVariableFile path if you want to override variables.
            label: Override file
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: Override file
          - defaultValue: "ex4" 
            description: >-
              pass repo name where you want to save intermediate state of
              terraform state.
            label: State repo
            mapping: 'manifest.spec.template.spec.containers[0].env[3].value'
            name: State repo
          - defaultValue: "ex5" 
            description: pass unique user id.
            label: UUId
            mapping: 'manifest.spec.template.spec.containers[0].env[4].value'
            name: UUId
          - defaultValue: "ex6" 
            description: pass custom k8Anotation to be add at pod level object.
            label: "iam.amazonaws.com/role"
            mapping: "manifest.spec.template.spec.template.metadata.annotations.'iam.amazonaws.com/role'"
            name: "k8annotation"
        manifest:
          apiVersion: batch/v1
          kind: Job
          metadata:
            name: terraspinplanjob
            namespace: spinterra
          spec:
            backoffLimit: 0
            template:
              metadata:
                annotations:
                  "[iam.amazonaws.com/role]":
              spec:
                containers:
                  - command:
                      - PlanRun.sh
                    env:
                      - name: artifactAccount
                        value: 
                      - name: plan
                        value: 
                      - name: variableOverrideFileRepo
                        value: 
                      - name: stateRepo
                        value: 
                      - name: uuId
                        value: 
                      - name: component
                        value: plan
                    image: 'docker.io/opsmx11/terraspinjob:3.0'
                    imagePullPolicy: Always
                    name: terraspinplan
                    volumeMounts:
                      - mountPath: /home/terraspin/opsmx/app/config/
                        name: opsmx-terraspin-backend-config
                restartPolicy: Never
                volumes:
                  - configMap:
                      name: terraspinbackendconfig
                    name: opsmx-terraspin-backend-config
      - label: TSApplyJob
        application: test
        cloudProvider: kubernetes
        credentials: default
        description: Stage for terraspin apply operation
        account: default
        propertyFile: terraspinapply
        type: customTSApplyJobStage
        waitForCompletion: true
        parameters:
          - defaultValue: "ex1" 
            description: pass git account name.
            label: Artifact account
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: Artifact account
          - defaultValue: "ex2" 
            description: pass overrideVariableFile path if you want to override variables.
            label: Override file
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: Override file
          - defaultValue: "ex3" 
            description: >-
              pass repo name where you want to save intermediate state of
              terraform state.
            label: State repo
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: State repo
          - defaultValue: "ex4" 
            description: pass unique user id.
            label: UUId
            mapping: 'manifest.spec.template.spec.containers[0].env[3].value'
            name: UUId
        manifest:
          apiVersion: batch/v1
          kind: Job
          metadata:
            name: terraspinapplyjob
            namespace: spinterra
          spec:
            backoffLimit: 0
            template:
              spec:
                containers:
                  - command:
                      - ApplyRun.sh
                    env:
                      - name: artifactAccount
                        value: 
                      - name: variableOverrideFileRepo
                        value: 
                      - name: stateRepo
                        value: 
                      - name: uuId
                        value: 
                      - name: component
                        value: apply
                    image: 'docker.io/opsmx11/terraspinjob:3.0'
                    imagePullPolicy: Always
                    name: terraspinapply
                    volumeMounts:
                      - mountPath: /home/terraspin/opsmx/app/config/
                        name: opsmx-terraspin-backend-config
                restartPolicy: Never
                volumes:
                  - configMap:
                      name: terraspinbackendconfig
                    name: opsmx-terraspin-backend-config
      - label: TSDestroyJob
        application: test
        cloudProvider: kubernetes
        credentials: default
        description: Stage for terraspin destroy operation
        account: default
        type: customTSDestroyJobStage
        waitForCompletion: true
        parameters:
          - defaultValue: "ex1" 
            description: pass git account name.
            label: Artifact account
            mapping: 'manifest.spec.template.spec.containers[0].env[0].value'
            name: Artifact account
          - defaultValue: "ex2" 
            description: >-
              pass repo name where you want to save intermediate state of
              terraform state.
            label: State repo
            mapping: 'manifest.spec.template.spec.containers[0].env[1].value'
            name: State repo
          - defaultValue: "ex3" 
            description: pass unique user id.
            label: UUID
            mapping: 'manifest.spec.template.spec.containers[0].env[2].value'
            name: UUID
        manifest:
          apiVersion: batch/v1
          kind: Job
          metadata:
            name: terraspindestroyjob
            namespace: spinterra
          spec:
            backoffLimit: 0
            template:
              spec:
                containers:
                  - command:
                      - DestroyRun.sh
                    env:
                      - name: artifactAccount
                        value: 
                      - name: stateRepo
                        value: 
                      - name: uuId
                        value: 
                      - name: component
                        value: destroy
                    image: 'docker.io/opsmx11/terraspinjob:3.0'
                    imagePullPolicy: Always
                    name: terraspindestroy
                    volumeMounts:
                      - mountPath: /home/terraspin/opsmx/app/config/
                        name: opsmx-terraspin-backend-config
                restartPolicy: Never
                volumes:
                  - configMap:
                      name: terraspinbackendconfig
                    name: opsmx-terraspin-backend-config
